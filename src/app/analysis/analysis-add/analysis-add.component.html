<div class="d-flex flex-column" id="content-wrapper">
  <div id="content">
    <div class="container-fluid">
      <h1 class="text-dark mb-4">Crear Nuevo Analysis</h1>
      <div class="card shadow">
        <div class="card-header py-3">
          <p class="text-primary m-0 font-weight-bold">Detalles</p>
        </div>
        <div class="card-body">
          <mat-spinner *ngIf="loadingService.loading"></mat-spinner>
          <form [formGroup]="form" (ngSubmit)="placeOrder()">
            <div class="row">
              <div class="col-md-2">
                <label for="id"><strong>id</strong><br></label>
                <input type="text" formControlName="id" placeholder="ID" class="form-control form-control-sm" readonly>
              </div>
              <div class="col">
                <label for="testId"><strong>Prueba</strong><br></label>

                <select name="" id="" class="form-control form-control-sm" (change)="selectPrueba($event)"
                  formControlName="testId">
                  <option value="null" disabled selected>...select..</option>
                  <option *ngFor="let opt of pruebas" [value]="opt.id">{{opt.description}}</option>
                </select>
                <div *ngIf="f['testId'].errors && f['testId'].invalid && f['testId'].touched"><small class="text-danger"
                    *ngIf="f['testId'].errors['required']">La Prueba es Requerida</small></div>
              </div>
              <div class="col">
                <label for="description"><strong>Descripción</strong><br></label>
                <input type="text" formControlName="description" placeholder="Descripción"
                  class="form-control form-control-sm">
              </div>
              <div class="col-md-2">
                <label for="abbreviation"><strong>Abreviatura</strong><br></label>
                <input type="text" formControlName="abbreviation" placeholder="Abreviatura"
                  class="form-control form-control-sm">
              </div>
            </div>
            <div class="row">
              <div class="col">
                <label for="analysisGroupId"><strong>Grupo</strong><br></label>
                <select name="" id="" class="form-control form-control-sm" formControlName="analysisGroupId">
                  <option value="null" disabled selected>...select..</option>
                  <option *ngFor="let opt of analysisGroupSource" [value]="opt.id">{{opt.name}}</option>
                </select>
                <div
                  *ngIf="f['analysisGroupId'].errors && f['analysisGroupId'].invalid && f['analysisGroupId'].touched">
                  <small class="text-danger" *ngIf="f['analysisGroupId'].errors['required']">analysisGroupId
                    es requerido</small>
                </div>
              </div>
              <div class="col">
                <label for="analysisSubGroupId"><strong>Sub-Grupo</strong><br></label>
                <select name="" id="" class="form-control form-control-sm" formControlName="analysisSubGroupId">
                  <option value="null" disabled selected>...select..</option>
                  <option *ngFor="let opt of analysisSubGroupSource" [value]="opt.id">{{opt.name}}</option>
                </select>
                <div
                  *ngIf="f['analysisSubGroupId'].errors && f['analysisSubGroupId'].invalid && f['analysisSubGroupId'].touched">
                  <small class="text-danger" *ngIf="f['analysisSubGroupId'].errors['required']">analysisSubGroupId es
                    requerido</small>
                </div>
              </div>
              <div class="col">
                <label for="sampleTypeId"><strong>Muestra</strong><br></label>
                <select name="" id="" class="form-control form-control-sm" formControlName="sampleTypeId">
                  <option value="null" disabled selected>...select..</option>
                  <option *ngFor="let opt of analysisSampleTypeSource" [value]="opt.id">{{opt.name}}</option>
                </select>
                <div *ngIf="f['sampleTypeId'].errors && f['sampleTypeId'].invalid && f['sampleTypeId'].touched"><small
                    class="text-danger" *ngIf="f['sampleTypeId'].errors['required']">sampleTypeId es
                    requerido</small></div>
              </div>
              <div class="col">
                <label for="sampleContainerId"><strong>Contenedor</strong><br></label>
                <select name="" id="" class="form-control form-control-sm" formControlName="sampleContainerId">
                  <option value="null" disabled selected>...select..</option>
                  <option *ngFor="let opt of analysisSampleContainerSource" [value]="opt.id">{{opt.name}}</option>
                </select>
                <div
                  *ngIf="f['sampleContainerId'].errors && f['sampleContainerId'].invalid && f['sampleContainerId'].touched">
                  <small class="text-danger" *ngIf="f['sampleContainerId'].errors['required']">sampleContainerId es
                    requerido</small>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <label for="labMethodId"><strong>Método</strong><br></label>
                <select name="" id="" class="form-control form-control-sm" formControlName="labMethodId">
                  <option value="null" disabled selected>...select..</option>
                  <option *ngFor="let opt of analysisMethodSource" [value]="opt.id">{{opt.name}}</option>
                </select>
                <div *ngIf="f['labMethodId'].errors && f['labMethodId'].invalid && f['labMethodId'].touched"><small
                    class="text-danger" *ngIf="f['labMethodId'].errors['required']">labMethodId es requerido</small>
                </div>
              </div>
              <div class="col">
                <label for="labEquipmentId"><strong>Equipo Interfaz</strong><br></label>
                <select name="" id="" class="form-control form-control-sm" formControlName="labEquipmentId">
                  <option value="null" disabled selected>...select..</option>
                  <option *ngFor="let opt of analysisEquipmentSource" [value]="opt.id">{{opt.description}}</option>
                </select>
                <div *ngIf="f['labEquipmentId'].errors && f['labEquipmentId'].invalid && f['labEquipmentId'].touched">
                  <small class="text-danger" *ngIf="f['labEquipmentId'].errors['required']">labEquipmentId es
                    requerido</small>
                </div>
              </div>
              <div class="col">
                <label for="labId"><strong>Laboratorio</strong><br></label>
                <select name="" id="" class="form-control form-control-sm" formControlName="labId">
                  <option value="null" disabled selected>...select..</option>
                  <option *ngFor="let opt of analysisLaboratorySource" [value]="opt.id">{{opt.name}}</option>
                </select>
                <div *ngIf="f['labId'].errors && f['labId'].invalid && f['labId'].touched"><small class="text-danger"
                    *ngIf="f['labId'].errors['required']">labId es requerido</small></div>
              </div>
              <div class="col">

                <label for="sex"><strong>Genero</strong><br></label>

                <select formControlName="sex" class="form-control form-control-sm">
                  <option value="null">...select..</option>
                  <option *ngFor="let gender of personGenderSouruce" [value]="gender.id">{{gender.name}}
                  </option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3">
                <label for="condition"><strong>Condición</strong><br></label>
                <input type="text" formControlName="condition" placeholder="Condición de la Muestra"
                  class="form-control form-control-sm">
              </div>
              <div class="col">
                <label for="day"><strong>day</strong><br></label>
                <input type="text" formControlName="day" class="form-control form-control-sm">
              </div>
              <div class="col">
                <label for="days"><strong>days</strong><br></label>
                <input type="text" formControlName="days" class="form-control form-control-sm">
              </div>
            </div>

            <hr class="my-4">

            <div class="form-check">
              <input class="form-check-input" type="checkbox" formControlName="webResult"
                aria-label="Checkbox for following text input">

              <label for="webResult" class="form-check-label">Resultados via Web</label>

            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" formControlName="normalValue"
                aria-label="Checkbox for following text input">

              <label for="normalValue" class="form-check-label">Valores Normales</label>

            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" formControlName="status"
                aria-label="Checkbox for following text input">

              <label for="status" class="form-check-label">Estado</label>

              <!-- <input type="text" formControlName="status" class="form-control form-control-sm"> -->
            </div>

            <hr class="my-4">

            <button type="button" class="btn btn-primary btn-sm" (click)="newVble()">Agregar Varaible</button>

            <hr class="my-4">

            <div formArrayName="variables">
              <section cdkDropList (cdkDropListDropped)="drop(fv, $event)" style="width: 100%;">
                <!-- <div formArrayName="variables" class="example-box" *ngFor="let vble of av.controls; let i = index" cdkDrag> -->
                <div class="example-box" *ngFor="let vble of fv.controls; let i = index" cdkDrag>
                  <div class="example-handle" cdkDragHandle>
                    <svg width="24px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z">
                      </path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                  </div>
                  <div class="example-custom-placeholder" *cdkDragPlaceholder></div>
                  <!-- <mat-expansion-panel hideToggle> -->
                  <mat-expansion-panel style="width: 100%;max-width: 95%;">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        <h4>{{i+1}}. {{vble.value.description}}</h4>
                      </mat-panel-title>
                      <mat-panel-description>
                        Variable Information
                      </mat-panel-description>
                    </mat-expansion-panel-header>
                    <ng-template matExpansionPanelContent>
                      <table class="table">
                        <!-- <ng-container [formGroupName]="i"> -->

                        <mat-card fxFlex="100%" fxFlex.xs="100%">
                          <mat-card-title>Create a new Variable</mat-card-title>

                          <div [formGroupName]="i" fxLayout="column wrap" fxLayoutAlign="center center"
                            fxLayoutGap="10px">
                            <mat-card-content>
                              <mat-form-field>
                                <mat-select placeholder="Tipo" formControlName="typeCode" [errorStateMatcher]="matcher">
                                  <mat-option [value]="0">-- None --</mat-option>
                                  <mat-option *ngFor="let vbleType of laboratoryAnalyVarTypeSource"
                                    [value]="vbleType.code">
                                    {{vbleType.description}}</mat-option>
                                </mat-select>
                                <mat-label>
                                  <b> Tipo </b> <i> Variable</i>
                                </mat-label>
                                <mat-error *ngIf="hasVarError(i,'typeCode', 'required')" class="invalid-feedback">
                                </mat-error>
                              </mat-form-field>
                              <mat-form-field>
                                <mat-label>Descripción</mat-label>
                                <input matInput type="text" placeholder="Descripción" formControlName="description"
                                  id="description">
                                <mat-hint align="end">Not more then 60 characters long.
                                </mat-hint>
                                <mat-error *ngIf="hasVarError(i,'description', 'required')">
                                  Name is required</mat-error>
                                <mat-error *ngIf="hasVarError(i,'description', 'minlength')">
                                  You
                                  have more than 60
                                  characters
                                </mat-error>
                                <mat-error *ngIf="hasVarError(i,'description', 'maxlength')">
                                  You
                                  have more than 60
                                  characters
                                </mat-error>
                              </mat-form-field>
                              <mat-form-field>
                                <mat-select placeholder="Unidad" formControlName="unitId" [errorStateMatcher]="matcher">
                                  <mat-option *ngFor="let labUnit of laboratoryUnitSource" [value]="labUnit.id">
                                    {{labUnit.name}}</mat-option>
                                </mat-select>
                                <mat-label>
                                  <b> Unidad de </b> <i> Medida</i>
                                </mat-label>
                              </mat-form-field>

                              <ng-container formArrayName="lab_analysis_variable_values" class="g-3 my-2">
                                <tr>
                                  <td colspan="4">
                                    <div *ngIf="vble.value.typeCode === 'L' ">
                                      <table class="table table-hover table-responsive table-striped table-bordered">
                                        <thead>
                                          <tr class="text-center">
                                            <th colspan="3" class="sub">
                                              valores
                                            </th>
                                            <th colspan="2" class="sub">
                                              otros </th>
                                            <th class="sub"> </th>
                                          </tr>
                                          <tr class="text-center">
                                            <th class="sub">valor</th>
                                            <th class="sub">anexo</th>
                                            <th class="sub">auto</th>
                                            <th class="sub">sexo</th>
                                            <th class="sub">metodo</th>
                                            <th class="sub" style="width: 150px; text-align: center;">
                                              Acción
                                            </th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <ng-container *ngFor="let vv of getVbleValues(i).controls; let j = index">
                                            <tr class="text-center" [formGroupName]="j">
                                              <td><input type="text" name="value" id="value"
                                                  class="form-control form-control-sm" [formControlName]="'value'">
                                              </td>
                                              <td><textarea matInput class="form-control form-control-sm"
                                                  formControlName="text"></textarea>
                                              </td>
                                              <td><input type="text" name="default" id="default"
                                                  class="form-control form-control-sm" [formControlName]="'default'">
                                              </td>
                                              <td>
                                                <div class="col">
                                                  <mat-form-field>
                                                    <mat-select placeholder="Sexo" formControlName="sex"
                                                      [errorStateMatcher]="matcher">
                                                      <mat-option [value]="0">
                                                        --
                                                        None --
                                                      </mat-option>
                                                      <mat-option value="M">
                                                        Masculino
                                                      </mat-option>
                                                      <mat-option value="F">
                                                        Femenino
                                                      </mat-option>
                                                      <mat-option value="A">
                                                        Ambos
                                                      </mat-option>
                                                      <!-- <mat-option *ngFor="let gender of personGenderSouruce"
                                                        [value]="gender.id">
                                                        {{gender.name}}
                                                      </mat-option> -->
                                                    </mat-select>
                                                    <mat-label>
                                                      <b> Genero
                                                      </b>
                                                    </mat-label>
                                                  </mat-form-field>
                                                </div>
                                              </td>
                                              <td>
                                                <div class="col">
                                                  <mat-form-field>
                                                    <mat-select placeholder="Metodo" formControlName="mtdoId"
                                                      [errorStateMatcher]="matcher">
                                                      <mat-option [value]="0">
                                                        --
                                                        None --
                                                      </mat-option>
                                                      <mat-option *ngFor="let labMethod of analysisMethodSource"
                                                        [value]="labMethod.id">
                                                        {{labMethod.name}}
                                                      </mat-option>
                                                    </mat-select>
                                                    <mat-label>
                                                      <b> Laboratory
                                                      </b>
                                                      <i>
                                                        Method</i>
                                                    </mat-label>
                                                    <mat-error *ngIf="hasVarValError(i,j,'mtdoId', 'required')"
                                                      class="invalid-feedback">
                                                      Debe
                                                      seleccionar
                                                      un
                                                      Metodo
                                                    </mat-error>
                                                  </mat-form-field>
                                                </div>
                                              </td>
                                              <td>
                                                <div class="action-bar right">
                                                  <ul>
                                                    <li>
                                                      <a mat-icon-button matTooltip="Eliminar Valor" color="warn"
                                                        (click)="removeVbleValue(i, j)">
                                                        <i class="fas fa-trash"></i>
                                                        <mat-icon>
                                                          delete
                                                        </mat-icon>
                                                      </a>
                                                    </li>
                                                  </ul>
                                                </div>
                                              </td>
                                            </tr>
                                          </ng-container>
                                        </tbody>
                                        <tfoot>
                                          <tr>
                                            <td colspan="6" style="text-align: center;">
                                              <div class="action-bar center">
                                                <ul>
                                                  <li>
                                                    <button mat-button type="button" matTooltip="Agregar Nuevo Valor"
                                                      color="primary" (click)="newVbleValue(i)">
                                                      <i class="fas fa-plus"></i>
                                                      Agregar
                                                      Nuevo Valor
                                                    </button>
                                                  </li>
                                                </ul>
                                              </div>
                                            </td>
                                          </tr>
                                        </tfoot>
                                      </table>
                                    </div>
                                    <div *ngIf="vble.value.typeCode === 'N' ">
                                      <table
                                        class="table table-hover table-responsive table-striped table-bordered table-sm">
                                        <thead>
                                          <tr class="text-center">
                                            <th colspan="2" class="sub">
                                              Edad </th>
                                            <th colspan="5" class="sub">
                                              Valores
                                            </th>
                                            <th colspan="3" class="sub">
                                              Otros </th>
                                            <th rowspan="2" class="sub" style="vertical-align: middle;">
                                              Acción
                                            </th>
                                          </tr>
                                          <tr class="text-center">
                                            <th class="sub">Desde</th>
                                            <th class="sub">Hasta</th>
                                            <th class="sub">Minimo</th>
                                            <th class="sub">Maximo</th>
                                            <th class="sub">Valor</th>
                                            <th class="sub">Anexo</th>
                                            <th class="sub">Auto</th>
                                            <th class="sub">Sexo</th>
                                            <th class="sub">Alarma Min</th>
                                            <th class="sub">Alarma Max</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <ng-container *ngFor="let vv of getVbleValues(i).controls; let j = index">
                                            <tr class="text-center" [formGroupName]="j">
                                              <td><input type="text" name="from" id="from"
                                                  class="form-control form-control-sm" formControlName="from">
                                              </td>
                                              <td><input type="text" name="to" id="to"
                                                  class="form-control form-control-sm" formControlName="to">
                                              </td>
                                              <td><input type="text" name="min" id="min"
                                                  class="form-control form-control-sm" #min formControlName="min">
                                              </td>
                                              <td><input type="text" name="max" id="max"
                                                  class="form-control form-control-sm" formControlName="max">
                                              </td>
                                              <td><input type="text" name="value" id="value"
                                                  class="form-control form-control-sm" formControlName="value">
                                              </td>
                                              <td> <textarea matInput class="form-control form-control-sm"
                                                  formControlName="text"></textarea>
                                              </td>
                                              <td><input type="text" name="default" id="default"
                                                  class="form-control form-control-sm" formControlName="default">
                                              </td>
                                              <td>
                                                <div class="col">
                                                  <mat-form-field>
                                                    <mat-select placeholder="Sexo" formControlName="sex"
                                                      [errorStateMatcher]="matcher">
                                                      <mat-option [value]="0">
                                                        --
                                                        None --
                                                      </mat-option>
                                                      <mat-option value="M">
                                                        Masculino
                                                      </mat-option>
                                                      <mat-option value="F">
                                                        Femenino
                                                      </mat-option>
                                                      <mat-option value="A">
                                                        Ambos
                                                      </mat-option>
                                                    </mat-select>
                                                    <mat-label>
                                                      <b> Sexo
                                                      </b>
                                                    </mat-label>
                                                  </mat-form-field>
                                                </div>
                                              </td>
                                              <td><input type="text" name="alarmMin" id="alarmMin"
                                                  class="form-control form-control-sm" formControlName="alarmMin">
                                              </td>
                                              <td><input type="text" name="alarmMax" id="alarmMax"
                                                  class="form-control form-control-sm" formControlName="alarmMax">
                                              </td>
                                              <td>
                                                <div class="action-bar right">
                                                  <ul>
                                                    <li>
                                                      <a mat-icon-button matTooltip="Eliminar Valor" color="warn"
                                                        (click)="removeVbleValue(i, j)">
                                                        <i class="fas fa-trash"></i>
                                                        <mat-icon>
                                                          delete
                                                        </mat-icon>
                                                      </a>
                                                    </li>
                                                  </ul>
                                                </div>
                                              </td>
                                            </tr>
                                          </ng-container>
                                        </tbody>
                                        <tfoot>
                                          <tr>
                                            <td colspan="11" style="text-align: center;">
                                              <div class="action-bar center">
                                                <ul>
                                                  <li>
                                                    <button mat-button type="button" matTooltip="Agregar Nuevo Valor"
                                                      color="primary" (click)="newVbleValue(i)">
                                                      <i class="fas fa-plus"></i>
                                                      Agregar
                                                      Nuevo Valor
                                                    </button>
                                                  </li>
                                                </ul>
                                              </div>
                                            </td>
                                          </tr>
                                        </tfoot>
                                      </table>
                                    </div>
                                    <div *ngIf="vble.value.typeCode === 'X' ">
                                      <table
                                        class="table table-hover table-responsive table-striped table-bordered table-sm">
                                        <thead>
                                          <tr class="text-center">
                                            <th colspan="2" class="sub">
                                              Edad </th>
                                            <th colspan="2" class="sub">
                                              Valores
                                            </th>
                                            <th class="sub"> Otros </th>
                                            <th rowspan="2" class="sub" style="vertical-align: middle;">
                                              Acción
                                            </th>
                                          </tr>
                                          <tr class="text-center">
                                            <th class="sub">Desde</th>
                                            <th class="sub">Hasta</th>
                                            <th class="sub">Texto</th>
                                            <th class="sub">Anexo</th>
                                            <th class="sub">Sexo</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <ng-container *ngFor="let vv of getVbleValues(i).controls; let j = index">
                                            <tr class="text-center" [formGroupName]="j">
                                              <td>
                                                <mat-form-field>
                                                  <input matInput type="text" placeholder="Desde" formControlName="from"
                                                    id="from">
                                                  <mat-hint align="end">
                                                    Not
                                                    more
                                                    then 60
                                                    characters long.
                                                  </mat-hint>
                                                  <mat-error *ngIf="hasVarValError(i,j,'description', 'required')">
                                                    Name is required
                                                  </mat-error>
                                                  <mat-error *ngIf="hasVarValError(i,j,'description', 'minlength')">
                                                    You have more
                                                    than 60
                                                    characters
                                                  </mat-error>
                                                  <mat-error *ngIf="hasVarValError(i,j,'description', 'maxlength')">
                                                    You have more
                                                    than 60
                                                    characters
                                                  </mat-error>
                                                </mat-form-field>
                                              </td>
                                              <td>
                                                <mat-form-field>
                                                  <input matInput type="text" placeholder="Hasta" formControlName="to"
                                                    id="to">
                                                  <mat-hint align="end">
                                                    Not
                                                    more
                                                    then 60
                                                    characters long.
                                                  </mat-hint>
                                                  <mat-error *ngIf="hasVarValError(i,j,'description', 'required')">
                                                    Name is required
                                                  </mat-error>
                                                  <mat-error *ngIf="hasVarValError(i,j,'description', 'minlength')">
                                                    You have more
                                                    than 60
                                                    characters
                                                  </mat-error>
                                                  <mat-error *ngIf="hasVarValError(i,j,'description', 'maxlength')">
                                                    You have more
                                                    than 60
                                                    characters
                                                  </mat-error>
                                                </mat-form-field>
                                              </td>
                                              <td>
                                                <mat-form-field>
                                                  <mat-label>Texto
                                                  </mat-label>
                                                  <textarea matInput class="form-control form-control-sm"
                                                    formControlName="value"></textarea>
                                                  <mat-hint align="end">
                                                    Not
                                                    more
                                                    then 60
                                                    characters long.
                                                  </mat-hint>
                                                </mat-form-field>
                                              </td>
                                              <td>
                                                <mat-form-field>
                                                  <mat-label>Anexo
                                                  </mat-label>
                                                  <textarea matInput class="form-control form-control-sm"
                                                    formControlName="text"></textarea>
                                                  <mat-hint align="end">
                                                    Not
                                                    more
                                                    then 60
                                                    characters long.
                                                  </mat-hint>
                                                </mat-form-field>
                                              </td>
                                              <td>
                                                <div class="col">
                                                  <mat-form-field>
                                                    <mat-select placeholder="Sexo" formControlName="sex"
                                                      [errorStateMatcher]="matcher">
                                                      <mat-option [value]="0">
                                                        --
                                                        None --
                                                      </mat-option>
                                                      <mat-option value="M">
                                                        Masculino
                                                      </mat-option>
                                                      <mat-option value="F">
                                                        Femenino
                                                      </mat-option>
                                                      <mat-option value="A">
                                                        Ambos
                                                      </mat-option>
                                                    </mat-select>
                                                    <mat-label>
                                                      <b> Sexo
                                                      </b>
                                                    </mat-label>
                                                  </mat-form-field>
                                                </div>
                                              </td>
                                              <td>
                                                <div class="action-bar right">
                                                  <ul>
                                                    <li>
                                                      <a mat-icon-button matTooltip="Eliminar Valor" color="warn"
                                                        (click)="removeVbleValue(i, j)">
                                                        <i class="fas fa-trash"></i>
                                                        <mat-icon>
                                                          delete
                                                        </mat-icon>
                                                      </a>
                                                    </li>
                                                  </ul>
                                                </div>
                                              </td>

                                              <td>
                                                <div class="action-bar right">
                                                  <ul>
                                                    <li>
                                                      <a mat-icon-button matTooltip="Eliminar Valor" color="warn"
                                                        (click)="removeVbleValue(i, j)">
                                                        <i class="fas fa-trash"></i>
                                                        <mat-icon>
                                                          delete
                                                        </mat-icon>
                                                      </a>
                                                    </li>
                                                  </ul>
                                                </div>
                                              </td>
                                            </tr>
                                          </ng-container>
                                        </tbody>
                                        <tfoot>
                                          <tr>
                                            <td colspan="11" style="text-align: center;">
                                              <div class="action-bar center">
                                                <ul>
                                                  <li>
                                                    <button mat-button type="button" matTooltip="Agregar Nuevo Valor"
                                                      color="primary" (click)="newVbleValue(i)">
                                                      <i class="fas fa-plus"></i>
                                                      Agregar
                                                      Nuevo Valor
                                                    </button>
                                                  </li>
                                                </ul>
                                              </div>
                                            </td>
                                          </tr>
                                        </tfoot>
                                      </table>
                                    </div>
                                  </td>
                                </tr>
                              </ng-container>

                            </mat-card-content>
                            <mat-card-actions>
                              <button mat-button type="button" matTooltip="Borrar Variable" color="warn"
                                (click)="removeVble(i)">
                                <mat-icon>delete</mat-icon>
                              </button>
                              <button mat-button type="button" matTooltip="Agregar Nuevo Valor"
                                (click)="newVbleValue(i)">
                                <mat-icon>add</mat-icon>
                              </button>
                            </mat-card-actions>
                          </div>
                        </mat-card>
                      </table>
                    </ng-template>
                  </mat-expansion-panel>
                </div>
              </section>
            </div>
            <br>
            <button class="btn btn-primary me-md-2" type="submit" [disabled]="!form.valid">
              <span *ngIf="loadingService.loading" class="spinner-border spinner-border-sm"></span>
              Guardar
            </button>
            <button type="button" mat-raised-button color="warn" (click)="onCancel()">Cancelar</button>
          </form>
        </div>
      </div>
      <!-- <br>
      <div class="card shadow">
        <div class="card-header py-3">
          <p class="text-primary m-0 font-weight-bold">Variables</p>
        </div>
        <div class="card-body">
          <form (ngSubmit)="placeOrder()" #addForm="ngForm" *ngIf="!loadingService.loading">
            <div class="row">
              <div class="col">
                
                <label for="distributor"><strong>Prueba</strong><br /></label>

                <select class="form-control form-control-sm" (change)="selectPrueba($event)" name="material"
                  [(ngModel)]="analysis.testId" #prueba="ngModel" required>
                  <optgroup label="This is a group">
                    <option value="0" disabled selected>
                      Select Prueba
                    </option>
                    <option *ngFor="let d of pruebas" [value]="d.id">
                      {{ d.description }}
                    </option>
                  </optgroup>
                </select>

                <div *ngIf="prueba.errors && prueba.invalid && prueba.touched">
                  <small class="text-danger" *ngIf="prueba.errors['required']">Prueba Name is required
                    field</small>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                <div class="form-group">
                  
                  <label for="phoneNo"><strong>Descripción</strong><br /></label>

                  <input [(ngModel)]="analysis.description" name="description" placeholder="Ingrese la Descripción"
                    class="form-control form-control-sm" required #description="ngModel" ngModel required />
                  <div *ngIf="description.touched && description.dirty && description.invalid"
                    class="alert alert-primary">
                    Plss Enter The Valid Quantity range.1-9999
                  </div>
                </div>
              </div>

              <div class="col">
                <div class="form-group">
                  
                  <label for="abbreviation"><strong>Abreviatura</strong><br /></label>

                  <input [(ngModel)]="analysis.abbreviation" name="abbreviation" placeholder="Ingrese la Abreviatura"
                    class="form-control form-control-sm" #abbreviation="ngModel" required />
                  <div *ngIf="abbreviation.touched && abbreviation.dirty && abbreviation.invalid"
                    class="alert alert-primary">
                    Plss Enter The Valid Quantity range.1-9999
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                
                <label for="analysisGroupId"><strong>Grupo</strong><br /></label>

                <select class="form-control form-control-sm" name="analysisGroupId"
                  [(ngModel)]="analysis.analysisGroupId" #analysisGroupId="ngModel" required>
                  <option value="null" disabled selecte...select..d>
                    Select Grupo
                  </option>
                  <option *ngFor="let ag of analysisGroupSource" [value]="ag.id">
                    {{ ag.name }}
                  </option>
                </select>

                <div *ngIf="analysisGroupId.errors && analysisGroupId.invalid && analysisGroupId.touched">
                  <small class="text-danger" *ngIf="analysisGroupId.errors['required']">Group is required
                    field</small>
                </div>
              </div>

              <div class="col">
                <div class="form-group">
                  
                  <label for="analysisSubGroupId"><strong>Sub Grupo</strong><br /></label>

                  <select class="form-control form-control-sm" [(ngModel)]="analysis.analysisSubGroupId"
                    name="analysisSubGroupId" #analysisSubGroupId="ngModel" required>
                    <optgroup label="This is a group">
                      <option value="null" disabled selecte...select..d>
                        Select Sub-Group
                      </option>
                      <option *ngFor="let asg of analysisSubGroupSource" [value]="asg.id">
                        {{ asg.name }}
                      </option>
                    </optgroup>
                  </select>
                  <div *ngIf="analysisSubGroupId.errors && analysisSubGroupId.invalid && analysisSubGroupId.touched">
                    <small class="text-danger" *ngIf="analysisSubGroupId.errors['required']">Sub-Group Name is
                      required
                      field</small>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                
                <label for="sampleTypeId"><strong>Tipo de Muestra</strong><br /></label>

                <select class="form-control form-control-sm" name="sampleTypeId" [(ngModel)]="analysis.sampleTypeId"
                  #sampleTypeId="ngModel" required>
                  <optgroup label="This is a group">
                    <option value="null" disabled selecte...select..d>
                      Select Grupo
                    </option>
                    <option *ngFor="let ast of analysisSampleTypeSource" [value]="ast.id">
                      {{ ast.name }}
                    </option>
                  </optgroup>
                </select>

                <div *ngIf="sampleTypeId.errors && sampleTypeId.invalid && sampleTypeId.touched">
                  <small class="text-danger" *ngIf="sampleTypeId.errors['required']">Group is required
                    field</small>
                </div>
              </div>

              <div class="col">
                <div class="form-group">
                  
                  <label for="sampleContainerId"><strong>Contenedor</strong><br /></label>

                  <select class="form-control form-control-sm" name="sampleContainerId"
                    [(ngModel)]="analysis.sampleContainerId" #sampleContainerId="ngModel" required>
                    <optgroup label="This is a group">
                      <option value="null" disabled selecte...select..d>
                        Select Grupo
                      </option>
                      <option *ngFor="let asc of analysisSampleContainerSource" [value]="asc.id">
                        {{ asc.name }}
                      </option>
                    </optgroup>
                  </select>

                  <div *ngIf="sampleContainerId.errors && sampleContainerId.invalid && sampleContainerId.touched">
                    <small class="text-danger" *ngIf="sampleContainerId.errors['required']">Group is required
                      field</small>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                
                <label for="labMethodId"><strong>Método</strong><br /></label>

                <select class="form-control form-control-sm" name="labMethodId" [(ngModel)]="analysis.labMethodId"
                  #labMethodId="ngModel" required>
                  <optgroup label="This is a group">
                    <option value="null" disabled selecte...select..d>
                      Select Grupo
                    </option>
                    <option *ngFor="let am of analysisMethodSource" [value]="am.id">
                      {{ am.name }}
                    </option>
                  </optgroup>
                </select>

                <div *ngIf="labMethodId.errors && labMethodId.invalid && labMethodId.touched">
                  <small class="text-danger" *ngIf="labMethodId.errors['required']">Group is required
                    field</small>
                </div>
              </div>

              <div class="col">
                <div class="form-group">
                  
                  <label for="labEquipmentId"><strong>Interfaz</strong><br /></label>

                  <select class="form-control form-control-sm" name="labEquipmentId"
                    [(ngModel)]="analysis.labEquipmentId" #labEquipmentId="ngModel">
                    <optgroup label="This is a group">
                      <option value="null" disabled selecte...select..d>
                        Select Grupo
                      </option>
                      <option *ngFor="let ae of analysisEquipmentSource" [value]="ae.id">
                        {{ ae.name }}
                      </option>
                    </optgroup>
                  </select>

                  <div *ngIf="labEquipmentId.errors && labEquipmentId.invalid && labEquipmentId.touched">
                    <small class="text-danger" *ngIf="labEquipmentId.errors['required']">Group is required
                      field</small>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                
                <label for="labId"><strong>Laboratorio</strong><br /></label>

                <select class="form-control form-control-sm" name="labId" [(ngModel)]="analysis.labId" #labId="ngModel">
                  <optgroup label="This is a group">
                    <option value="null" disabled selecte...select..d>
                      Select Grupo
                    </option>
                    <option *ngFor="let al of analysisLaboratorySource" [value]="al.id">
                      {{ al.name }}
                    </option>
                  </optgroup>
                </select>

                <div *ngIf="labId.errors && labId.invalid && labId.touched">
                  <small class="text-danger" *ngIf="labId.errors['required']">Group is required
                    field</small>
                </div>
              </div>

              <div class="col">
                <div class="form-group">
                  
                  <label for="days"><strong>Días</strong><br /></label>

                  <input [(ngModel)]="analysis.days" name="days" placeholder="Ingrese los días"
                    class="form-control form-control-sm" required
                    pattern="^(?:[1-9][0-9]{3}|[1-9][0-9]{2}|[1-9][0-9]|[1-9])$" #days="ngModel" required />
                  <div *ngIf="days.touched && days.dirty && days.invalid" class="alert alert-primary">
                    Plss Enter The Valid Dias range.1-9999
                  </div>
                </div>
              </div>
            </div>

            <br>

            <button class="btn btn-primary" type="submit" [disabled]="!addForm.valid">
              <span *ngIf="loadingService.loading" class="spinner-border spinner-border-sm"></span>
              PLACED ORDER
            </button>
          </form>
        </div>
      </div> -->
    </div>
  </div>
</div>